<template>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    .mcp-shell {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .mcp-app-container {
      flex: 1;
      min-height: 0;
      width: 100%;
      overflow: auto;
    }
    .mcp-status-bar {
      flex-shrink: 0;
      line-height: 1.4;
      padding: 4px 12px;
      background: var(--sl-color-neutral-100);
      border-top: 1px solid var(--sl-color-neutral-200);
      font-family: var(--sl-font-sans);
      font-size: var(--sl-font-size-small);
    }
    .mcp-status-bar::after {
      content: '\00a0';  /* non-breaking space to maintain height when empty */
    }
    .mcp-status-bar .thinking {
      color: #E07A47;
      font-weight: bold;
      font-style: italic;
    }
    .mcp-menu-container {
      position: fixed;
      top: 8px;
      right: 8px;
      z-index: 10000;
    }
    .mcp-menu-button {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      padding: 0;
      border: none;
      background: rgba(255, 255, 255, 0.9);
      border-radius: var(--sl-border-radius-medium);
      box-shadow: 0 0 8px 2px rgba(100, 149, 237, 0.6);
      cursor: pointer;
      transition: box-shadow 0.2s;
    }
    .mcp-menu-button:hover {
      box-shadow: 0 0 12px 4px rgba(100, 149, 237, 0.8);
    }
    .mcp-menu-button .mcp-icon {
      font-size: 1.5rem;
      color: var(--sl-color-neutral-600);
    }
    .mcp-menu-button .mcp-spinner {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 1;
      pointer-events: none;
    }
    .mcp-menu-button .mcp-spinner sl-spinner {
      font-size: 1.3rem;
      --track-width: 3px;
      --indicator-color: #E07A47;
      filter: drop-shadow(0 0 4px #E07A47) drop-shadow(0 0 8px #F5A97F);
    }
    .mcp-menu-dropdown {
      position: fixed;
      top: 44px;
      right: 8px;
      z-index: 10000;
      background: var(--sl-color-neutral-0);
      border: 1px solid var(--sl-color-neutral-200);
      border-radius: var(--sl-border-radius-medium);
      box-shadow: var(--sl-shadow-large);
      min-width: 150px;
      padding: var(--sl-spacing-x-small) 0;
    }
    .mcp-menu-item {
      padding: var(--sl-spacing-small) var(--sl-spacing-medium);
      cursor: pointer;
      font-family: var(--sl-font-sans);
      font-size: var(--sl-font-size-medium);
    }
    .mcp-menu-item:hover {
      background: var(--sl-color-primary-50);
    }
    .hidden { display: none !important; }
  </style>

  <div class="mcp-shell">
    <!-- Current app content -->
    <div class="mcp-app-container" ui-view="value"></div>

    <!-- Status bar -->
    <div class="mcp-status-bar">
      <span ui-attr-class="statusClass" ui-value="statusLine"></span>
    </div>

    <!-- App switcher menu button (9-dot grid) - floats above all content -->
    <div class="mcp-menu-container">
      <button class="mcp-menu-button" ui-action="toggleMenu()" title="App Menu">
        <sl-icon class="mcp-icon" name="grid-3x3-gap-fill"></sl-icon>
        <!-- Processing indicator - shows when agent is not connected to /wait -->
        <span class="mcp-spinner" ui-class-hidden="pollingEvents()">
          <sl-spinner></sl-spinner>
        </span>
      </button>
    </div>

    <!-- Dropdown menu -->
    <div class="mcp-menu-dropdown" ui-class-hidden="menuHidden()">
      <div ui-view="availableApps()?wrapper=lua.ViewList"></div>
    </div>

    <!-- Hidden element for JavaScript execution -->
    <div style="display:none;" ui-code="code"></div>
  </div>
</template>
